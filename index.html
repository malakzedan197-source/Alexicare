<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± - Ø¨Ø§ØªÙ…Ø§Ù† Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Changa:wght@400;600;800&display=swap');

        body {
            font-family: 'Changa', sans-serif;
            background: linear-gradient(135deg, #fef3c7 0%, #ffc0cb 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            position: relative;
        }

        .star-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: #fff9e0;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle 5s infinite ease-in-out;
        }

        .star:nth-child(1) {
            top: 10%;
            left: 5%;
            width: 15px;
            height: 15px;
            animation-delay: 0s;
        }

        .star:nth-child(2) {
            top: 20%;
            right: 10%;
            width: 10px;
            height: 10px;
            animation-delay: 1.5s;
        }

        .star:nth-child(3) {
            bottom: 5%;
            left: 15%;
            width: 8px;
            height: 8px;
            animation-delay: 3s;
        }

        .star:nth-child(4) {
            bottom: 25%;
            right: 5%;
            width: 12px;
            height: 12px;
            animation-delay: 0.5s;
        }

        .star:nth-child(5) {
            top: 40%;
            left: 30%;
            width: 18px;
            height: 18px;
            animation-delay: 2.2s;
        }

        .star:nth-child(6) {
            top: 60%;
            right: 20%;
            width: 9px;
            height: 9px;
            animation-delay: 4s;
        }

        @keyframes twinkle {
            0%, 100% {
                transform: scale(0.5);
                opacity: 0.5;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .screen-container {
            transition: opacity 0.5s ease-in-out, transform 0.5s;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .emotion-button {
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .emotion-button:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        .avatar-image-container {
            width: 80px;
            height: 80px;
            overflow: hidden;
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .avatar-image-container img {
            width: 100%;
            height: 100%;
            object-fit: fill;
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            50% {
                transform: translateX(5px);
            }
            75% {
                transform: translateX(-5px);
            }
        }

        .animate-shake {
            animation: shake 0.5s infinite;
        }

        #tts-control {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: #4f46e5;
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        #tts-control:hover {
            transform: scale(1.1);
            background: #4338ca;
        }

        #tts-control.muted {
            background: #6b7280;
        }

        #tts-control i {
            font-size: 24px;
        }
        
        .recording {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>

<body class="p-4 md:p-8">

    <!-- TTS Control Button -->
    <div id="tts-control" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª">
        <i class="fas fa-volume-up"></i>
    </div>

    <div class="star-bg">
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
    </div>

    <div id="batman-guide"
        class="fixed top-4 right-4 z-50 flex items-center space-x-2 space-x-reverse bg-yellow-400 p-2 rounded-xl shadow-2xl border-4 border-yellow-600 transition duration-500"
        style="display: none;">
        <div class="w-12 h-12 flex-shrink-0 text-gray-800 animate-bounce">
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                <path
                    d="M12 1.5C6.201 1.5 1.5 6.201 1.5 12c0 5.093 3.66 9.38 8.5 10.383V16.5H7.5V14h2.5V12c0-2 1.5-3.5 3.5-3.5s3.5 1.5 3.5 3.5v2h-2.5v2.5h2.5V21.5c4.787-1.12 8.5-5.32 8.5-10.233C22.5 6.201 17.799 1.5 12 1.5zm-3 10.5h6v1h-6v-1z"
                    fill="#000000" />
            </svg>
        </div>
        <div
            class="bg-white p-2 rounded-lg relative before:content-[''] before:absolute before:border-8 before:border-transparent before:border-r-white before:-right-4 before:top-1/2 before:-translate-y-1/2">
            <p id="guide-instruction" class="text-gray-800 text-sm font-semibold whitespace-nowrap">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø±!</p>
        </div>
    </div>

    <div id="app-container" class="w-full max-w-lg mx-auto">

        <script>
            // --- Global Variables and Constants ---
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            let userName = '';
            let userGender = '';
            let userAvatar = null;
            let currentEmotion = null;
            let audioInitialized = false;
            let isRecordingName = false;
            let nameRecognition = null;
            let ttsEnabled = true;
            let ttsSupported = true;
            let speechRecognitionSupported = true;

            const instructions = {
                'welcome-screen': 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„! Ø£Ù†Ø§ Ø¨Ø§ØªÙ…Ø§Ù†ØŒ ØµØ¯ÙŠÙ‚Ùƒ Ø§Ù„Ø®Ø§Ø±Ù‚. Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„ØªÙ†Ø·Ù„Ù‚ Ù…Ø¹Ù†Ø§ ÙÙŠ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©!',
                'avatar-screen': 'Ù‡ÙŠØ§ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø«Ù„Ùƒ! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ØªÙŠ ØªØ­Ø¨Ù‡Ø§ØŒ Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ù‡Ø°Ù‡ Ø´Ø®ØµÙŠØªÙŠ!".',
                'checkin-screen': 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ù‚Ø¨Ù„ Ø£Ù† Ù†Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ØŒ Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¬ÙˆÙ‡ Ø§Ù„Ù…Ø¹Ø¨Ø±Ø© Ø¹Ù† Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†. ÙÙ‚Ø· Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ÙˆØ¬Ù‡ ÙˆØ§Ø­Ø¯.',
                'main-menu': 'Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø¹Ø¨ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ! Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù…ØºØ§Ù…Ø±Ø§ØªØŒ Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².',
                'learning-screen': 'Ø§Ø³Ù…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø´Ø¹ÙˆØ±! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ù„ØªØªØ­Ø¯Ø« Ø¹Ù† Ù†ÙØ³Ù‡Ø§ØŒ Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø§Ù„ØªØ§Ù„ÙŠ".',
                'face-detection-screen': 'Ø§Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ­Ø§ÙˆÙ„ Ø£Ù† ØªØµÙ†Ø¹ ÙˆØ¬Ù‡Ø§Ù‹ Ø³Ø¹ÙŠØ¯Ø§Ù‹! ÙƒÙ† Ø¨Ø·Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØ¹Ø¨ÙŠØ±!',
                'challenge-screen': 'Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠ! Ø§Ù‚Ø±Ø£ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ØªÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·.',
                'leaderboard-screen': 'Ù‡Ù†Ø§ ØªØ±Ù‰ ØªØ±ØªÙŠØ¨Ùƒ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¨Ø·Ø§Ù„! ÙƒÙ… Ù†Ø¬Ù…Ø© Ø³ØªØ­ØµÙ„ Ø§Ù„ÙŠÙˆÙ…ØŸ Ø¹Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.'
            };

            // --- Avatar Data for Dynamic Loading ---
            const avatars = {
                boy: [
                    { id: 1, name: 'Ø¨Ø§ØªÙ…Ø§Ù†', imagePath: 'batman.jpg', color: 'bg-black', border: 'border-yellow-500' },
                    { id: 2, name: 'Ø³Ø¨Ø§ÙŠØ¯Ø±Ù…Ø§Ù†', imagePath: 'spiderman.jpg', color: 'bg-red-800', border: 'border-blue-500' },
                    { id: 3, name: 'Ø³ÙˆØ¨Ø±Ù…Ø§Ù†', imagePath: 'super.jpg', color: 'bg-blue-800', border: 'border-red-500' },
                    { id: 4, name: 'Ù…ÙŠÙƒÙŠ Ù…Ø§ÙˆØ³', imagePath: 'mickey mouse.jpg', color: 'bg-black', border: 'border-gray-500' },
                    { id: 5, name: 'ÙˆÙˆØ¯ÙŠ', imagePath: 'woody.jpg', color: 'bg-orange-800', border: 'border-yellow-600' },
                    { id: 6, name: 'Ø³Ø¨ÙˆÙ†Ø¬ Ø¨ÙˆØ¨', imagePath: 'sponge pop.jpg', color: 'bg-yellow-400', border: 'border-orange-500' }
                ],
                girl: [
                    { id: 7, name: 'Ø¨Ø§Ø±Ø¨ÙŠ', imagePath: 'barbie.jpg', color: 'bg-pink-500', border: 'border-pink-500' },
                    { id: 8, name: 'Ù…ÙŠÙ†ÙŠ Ù…Ø§ÙˆØ³', imagePath: 'minimouse.jpg', color: 'bg-black', border: 'border-gray-500' },
                    { id: 9, name: 'Ø¥Ù„Ø³Ø§', imagePath: 'elsa.jpg', color: 'bg-blue-300', border: 'border-blue-500' },
                    { id: 10, name: 'Ù…ÙˆØ§Ù†Ø§', imagePath: 'moana.jpg', color: 'bg-teal-500', border: 'border-red-300' },
                    { id: 11, name: 'Ø±Ø§Ø¨ÙˆÙ†Ø²Ù„', imagePath: 'tangled.jpg', color: 'bg-purple-300', border: 'border-purple-500' },
                    { id: 12, name: 'Ø³Ø¨ÙˆÙ†Ø¬ Ø¨ÙˆØ¨', imagePath: 'sponge pop.jpg', color: 'bg-yellow-400', border: 'border-orange-500' }
                ]
            };

            // Function to generate the HTML grid for avatars
            function generateAvatarGrid(gender) {
                const avatarList = avatars[gender] || avatars.boy;
                let html = '';

                avatarList.forEach(avatar => {
                    const cardClass = `p-4 rounded-2xl cursor-pointer text-center shadow-md transition duration-300 bg-gray-100 text-gray-800`;

                    const contentHtml = `
                        <div class="avatar-image-container border-4 ${avatar.border}">
                            <img src="${avatar.imagePath}" alt="${avatar.name}">
                        </div>
                    `;

                    html += `
                        <div id="avatar-${avatar.id}" onclick="selectAvatar(${avatar.id})" 
                            class="avatar-card ${cardClass}" 
                            data-avatar-name="${avatar.name}">
                            ${contentHtml}
                            <span class="text-lg font-semibold mt-2 block">${avatar.name}</span>
                        </div>
                    `;
                });
                return html;
            }

            // --- TTS Logic ---
            function initTTS() {
                ttsSupported = !!(window.speechSynthesis);
                if (!ttsSupported) {
                    console.warn('TTS not supported in this browser');
                }
                
                // Check speech recognition support
                speechRecognitionSupported = !!(window.SpeechRecognition || window.webkitSpeechRecognition);
                if (!speechRecognitionSupported) {
                    console.warn('Speech recognition not supported in this browser');
                }
            }

            function speakInstruction(text) {
                if (!ttsEnabled || !ttsSupported) {
                    showGuide(text);
    
                    return;
                }

                const synth = window.speechSynthesis;

                // Cancel any ongoing speech
                if (synth.speaking) {
                    synth.cancel();
                }

                const utterance = new SpeechSynthesisUtterance(text);

                // Configure for Arabic
                utterance.lang = 'ar-SA';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;

                // Show guide immediately
                showGuide(text);

                utterance.onend = () => {
                   
                };

                utterance.onerror = (event) => {
                    console.error('TTS Error:', event);
                    ttsSupported = false;
                   
                };

                try {
                    synth.speak(utterance);
                } catch (error) {
                    console.error('TTS Failed:', error);
                    ttsSupported = false;
                    
                }
            }

            function showGuide(text) {
                const guideElement = document.getElementById('batman-guide');
                const instructionText = document.getElementById('guide-instruction');
                if (guideElement && instructionText) {
                    instructionText.textContent = text;
                    guideElement.style.display = 'flex';
                }
            }

            function toggleTTS() {
                ttsEnabled = !ttsEnabled;
                const ttsButton = document.getElementById('tts-control');
                const icon = ttsButton.querySelector('i');

                if (ttsEnabled) {
                    ttsButton.classList.remove('muted');
                    icon.classList.remove('fa-volume-mute');
                    icon.classList.add('fa-volume-up');
                    speakInstruction('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                } else {
                    ttsButton.classList.add('muted');
                    icon.classList.remove('fa-volume-up');
                    icon.classList.add('fa-volume-mute');
                    if (window.speechSynthesis) {
                        window.speechSynthesis.cancel();
                    }
                    showGuide('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª');
                }
            }

            // --- Audio Initialization ---
            function initializeAudioAndStart() {
                initTTS();

                if (audioInitialized) {
                    startApp();
                    return;
                }

                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        audioInitialized = true;
                        document.getElementById('audio-note').style.display = 'none';
                    
                        startApp();
                    }).catch(error => {
                        console.error('AudioContext failed:', error);
                        audioInitialized = true;
                        document.getElementById('audio-note').style.display = 'none';
                        startApp();
                    });
                } else {
                    audioInitialized = true;
                    document.getElementById('audio-note').style.display = 'none';
                
                    startApp();
                }
            }


            // --- Screen Navigation ---
            function showScreen(id) {
                document.querySelectorAll('.screen-container').forEach(screen => {
                    screen.classList.add('hidden');
                    screen.style.opacity = '0';
                    screen.style.transform = 'scale(0.95)';
                });

                const targetScreen = document.getElementById(id);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    void targetScreen.offsetWidth;
                    targetScreen.style.opacity = '1';
                    targetScreen.style.transform = 'scale(1)';

                    const instruction = instructions[id] || 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´Ø§Ø´Ø© Ø¬Ø¯ÙŠØ¯Ø©!';

                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(instruction);
                    } else {
                        showGuide(instruction);
                    }

                    if (id === 'avatar-screen') {
                        const avatarGrid = document.getElementById('avatar-grid');
                        if (avatarGrid) {
                            avatarGrid.innerHTML = generateAvatarGrid(userGender);
                            userAvatar = null;
                        }
                    }

                    if (id === 'checkin-screen') {
                        document.getElementById('checkin-prompt').innerText = `ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø§Ù„ÙŠÙˆÙ… ÙŠØ§ ${userName || 'Ø¨Ø·Ù„Ù†Ø§'}ØŸ`;
                        currentEmotion = null;
                        document.querySelectorAll('.emotion-button').forEach(btn => {
                            btn.classList.remove('ring-4', 'ring-pink-500', 'shadow-2xl');
                        });
                    }

                    if (id === 'main-menu') {
                        document.getElementById('menu-welcome').innerText = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„ ${userName || 'Ø§Ù„Ø®Ø§Ø±Ù‚'}!`;
                    }
                }
            }

            // --- Name Recording Function (Fixed) ---
            function startNameRecording() {
                if (!speechRecognitionSupported) {
                    const message = "Ø¹Ø°Ø±Ø§Ù‹! Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­. Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­.";
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                    return;
                }

                if (isRecordingName) {
                    stopNameRecording();
                    return;
                }

                try {
                    nameRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    nameRecognition.lang = 'ar-SA';
                    nameRecognition.interimResults = false;
                    nameRecognition.maxAlternatives = 1;
                    nameRecognition.continuous = false;

                    const micButton = document.getElementById('name-record-button');
                    const micIcon = document.getElementById('name-record-icon');
                    
                    micButton.classList.add('bg-red-500', 'recording');
                    micIcon.classList.remove('fa-microphone');
                    micIcon.classList.add('fa-stop');
                    isRecordingName = true;
                    
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction("ØªÙƒÙ„Ù… Ø§Ù„Ø¢Ù† ÙˆÙ‚Ù„ Ø§Ø³Ù…Ùƒ Ø¨ÙˆØ¶ÙˆØ­.");
                    } else {
                        showGuide("ØªÙƒÙ„Ù… Ø§Ù„Ø¢Ù† ÙˆÙ‚Ù„ Ø§Ø³Ù…Ùƒ Ø¨ÙˆØ¶ÙˆØ­.");
                    }
                    
                    nameRecognition.start();

                    nameRecognition.onresult = (event) => {
                        const nameResult = event.results[0][0].transcript;
                        document.getElementById('name-input').value = nameResult;
                        userName = nameResult;
                        stopNameRecording();
                        if (ttsEnabled && ttsSupported) {
                            speakInstruction(`Ø£Ø­Ø³Ù†Øª! Ø§Ø³Ù…Ùƒ Ù‡Ùˆ ${nameResult}. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù†Ø·Ù„Ù‚ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.`);
                        } else {
                            showGuide(`Ø£Ø­Ø³Ù†Øª! Ø§Ø³Ù…Ùƒ Ù‡Ùˆ ${nameResult}. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù†Ø·Ù„Ù‚ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.`);
                        }
                    };

                    nameRecognition.onerror = (event) => {
                        console.error('Name recording error:', event.error);
                        stopNameRecording();
                        
                        let errorMessage = "Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø³Ù…Ø§Ø¹ Ø§Ø³Ù…Ùƒ Ø¨ÙˆØ¶ÙˆØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!";
                        if (event.error === 'no-speech') {
                            errorMessage = "Ù„Ù… Ø£Ø³Ù…Ø¹ Ø£ÙŠ ØµÙˆØª. Ø­Ø§ÙˆÙ„ Ø§Ù„ØªØ­Ø¯Ø« Ø¨ØµÙˆØª Ø£Ø¹Ù„Ù‰.";
                        } else if (event.error === 'audio-capture') {
                            errorMessage = "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†.";
                        } else if (event.error === 'not-allowed') {
                            errorMessage = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù†.";
                        }
                        
                        if (ttsEnabled && ttsSupported) {
                            speakInstruction(errorMessage);
                        } else {
                            showGuide(errorMessage);
                        }
                    };

                    nameRecognition.onend = () => {
                        if (isRecordingName) {
                            stopNameRecording();
                            if (ttsEnabled && ttsSupported) {
                                speakInstruction("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒØªØ¨ Ø§Ø³Ù…Ùƒ.");
                            } else {
                                showGuide("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒØªØ¨ Ø§Ø³Ù…Ùƒ.");
                            }
                        }
                    };

                } catch (error) {
                    console.error('Failed to initialize speech recognition:', error);
                    speechRecognitionSupported = false;
                    const message = "Ø¹Ø°Ø±Ø§Ù‹! Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ±. Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­.";
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                }
            }

            function stopNameRecording() {
                if (nameRecognition) {
                    try {
                        nameRecognition.stop();
                    } catch (e) {
                        console.log('Speech recognition already stopped');
                    }
                    nameRecognition = null;
                }
                
                const micButton = document.getElementById('name-record-button');
                const micIcon = document.getElementById('name-record-icon');
                
                if (micButton) {
                    micButton.classList.remove('bg-red-500', 'recording');
                }
                if (micIcon) {
                    micIcon.classList.remove('fa-stop');
                    micIcon.classList.add('fa-microphone');
                }
                isRecordingName = false;
            }

            // --- Voice Input for Other Fields ---
            function startVoiceInput(inputId) {
                if (!speechRecognitionSupported) {
                    const message = "Ø¹Ø°Ø±Ø§Ù‹! Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ±. Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­.";
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                    return;
                }

                try {
                    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    recognition.lang = 'ar-SA';
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;
                    recognition.continuous = false;

                    const inputElement = document.getElementById(inputId);
                    const micIcon = document.getElementById(`mic-icon-${inputId}`);

                    if (micIcon) {
                        micIcon.classList.add('animate-pulse', 'text-red-600');
                    }

                    if (ttsEnabled && ttsSupported) {
                        speakInstruction("Ø£Ø³ØªÙ…Ø¹ Ø¥Ù„ÙŠÙƒ! ØªÙƒÙ„Ù… Ø¨ÙˆØ¶ÙˆØ­ Ø§Ù„Ø¢Ù†.");
                    } else {
                        showGuide("Ø£Ø³ØªÙ…Ø¹ Ø¥Ù„ÙŠÙƒ! ØªÙƒÙ„Ù… Ø¨ÙˆØ¶ÙˆØ­ Ø§Ù„Ø¢Ù†.");
                    }

                    recognition.start();

                    recognition.onresult = (event) => {
                        const speechResult = event.results[0][0].transcript;
                        if (inputElement) {
                            inputElement.value = speechResult;
                        }
                        if (micIcon) {
                            micIcon.classList.remove('animate-pulse', 'text-red-600');
                        }
                        if (ttsEnabled && ttsSupported) {
                            speakInstruction(`Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ ÙƒØªØ¨Øª: ${speechResult}`);
                        } else {
                            showGuide(`Ø£Ø­Ø³Ù†Øª! ØªÙ… Ø§Ù„ÙƒØªØ§Ø¨Ø©: ${speechResult}`);
                        }
                    };

                    recognition.onerror = (event) => {
                        if (micIcon) {
                            micIcon.classList.remove('animate-pulse', 'text-red-600');
                        }
                        console.error('Speech recognition error:', event.error);
                        const errorMsg = "Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø³Ù…Ø§Ø¹Ùƒ Ø¨ÙˆØ¶ÙˆØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!";
                        if (ttsEnabled && ttsSupported) {
                            speakInstruction(errorMsg);
                        } else {
                            showGuide(errorMsg);
                         
                        }
                    };
                } catch (error) {
                    console.error('Failed to initialize speech recognition:', error);
                    speechRecognitionSupported = false;
                    const message = "Ø¹Ø°Ø±Ø§Ù‹! Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ±. Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­.";
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                       
                    }
                }
            }

            // --- Screen Specific Logic ---
            function startApp() {
                const nameInput = document.getElementById('name-input');
                userName = nameInput ? nameInput.value.trim() : '';
                const gender = document.querySelector('input[name="gender"]:checked');

                if (!userName) {
                    const message = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„!';
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                    return;
                }
                if (!gender) {
                    const message = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³ (ÙˆÙ„Ø¯ Ø£Ùˆ Ø¨Ù†Øª) Ù„ØªØ­Ø¯ÙŠØ¯ Ø´Ø®ØµÙŠØªÙƒ!';
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                    return;
                }
                userGender = gender.value;
                showScreen('avatar-screen');
            }

            function selectAvatar(avatarId) {
                userAvatar = avatarId;
                document.querySelectorAll('.avatar-card').forEach(card => {
                    card.classList.remove('ring-4', 'ring-yellow-500', 'scale-110');
                });
                const selectedCard = document.getElementById(`avatar-${avatarId}`);
                if (selectedCard) {
                    selectedCard.classList.add('ring-4', 'ring-yellow-500', 'scale-110');
                }

                const message = 'Ø£Ø­Ø³Ù†Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±! Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø·Ù„ Ø³ÙŠÙƒÙˆÙ† ØµØ¯ÙŠÙ‚Ùƒ ÙÙŠ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©.';
                if (ttsEnabled && ttsSupported) {
                    speakInstruction(message);
                } else {
                    showGuide(message);
                }
            }

            function confirmAvatar() {
                if (!userAvatar) {
                    const message = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© Ù„ØªÙ…Ø«Ù„Ùƒ ÙŠØ§ Ø¨Ø·Ù„!';
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                    return;
                }
                showScreen('checkin-screen');
            }

            function selectEmotion(emotion, audioPrompt, button) {
                currentEmotion = emotion;
                document.querySelectorAll('.emotion-button').forEach(btn => {
                    btn.classList.remove('ring-4', 'ring-pink-500', 'shadow-2xl');
                });
                if (button) {
                    button.classList.add('ring-4', 'ring-pink-500', 'shadow-2xl');
                }

                const message = `Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª Ø´Ø¹ÙˆØ± ${audioPrompt}. Ø§Ù„Ø¢Ù† Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø§ÙƒÙ…Ù„ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©" ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„.`;
                if (ttsEnabled && ttsSupported) {
                    speakInstruction(message);
                } else {
                    showGuide(message);
                }
            }

            function recordAndNavigate() {
                if (!currentEmotion) {
                    const message = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø´Ø¹ÙˆØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ³Ø¬Ù„ Ø¥Ù†Ø¬Ø§Ø²Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ!';
                    if (ttsEnabled && ttsSupported) {
                        speakInstruction(message);
                    } else {
                        showGuide(message);
                    }
                    return;
                }
                const message = `Ø³Ø¬Ù„Ù†Ø§ Ø´Ø¹ÙˆØ±Ùƒ! Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…ØºØ§Ù…Ø±Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.`;
                if (ttsEnabled && ttsSupported) {
                    speakInstruction(message);
                } else {
                    showGuide(message);
                    
                }
                showScreen('main-menu');
            }

            function startLevel(level, levelName) {
                const message = `ØªØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level}. ØªØ¹Ù„Ù… Ø¹Ù† ${levelName}ØŒ Ø«Ù… Ø³Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!`;
                if (ttsEnabled && ttsSupported) {
                    speakInstruction(message);
                } else {
                    showGuide(message);
                   
                }
                showScreen('learning-screen');
            }

            // --- Initialization ---
            document.addEventListener('DOMContentLoaded', () => {
                initTTS();

                const ttsControl = document.getElementById('tts-control');
                if (ttsControl) {
                    ttsControl.addEventListener('click', toggleTTS);
                }

                showScreen('welcome-screen');

                if (!audioInitialized) {
                    const audioNote = document.getElementById('audio-note');
                    if (audioNote) {
                        audioNote.style.display = 'block';
                    }
                }

                showGuide('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ø±! Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ§Ø®ØªØ± Ø¬Ù†Ø³Ùƒ Ø«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù†Ø·Ù„Ù‚!');
               
            });
        </script>

        <!-- Rest of HTML remains the same -->
        <div id="welcome-screen" class="screen-container bg-white p-6 rounded-3xl shadow-2xl space-y-8">
            <h1 class="text-4xl font-extrabold text-pink-600 text-center mt-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ø±!</h1>

            <div class="flex justify-center">
                <span class="text-[8rem] block animate-pulse">ğŸŒŸ</span>
            </div>

            <div class="space-y-3">
                <label for="name-input" class="block text-xl font-bold text-teal-600 text-center">Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ù…ÙŠÙ„ØŸ</label>
                <div class="flex items-center space-x-2 space-x-reverse">
                    <input type="text" id="name-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§"
                        class="flex-grow p-4 border-4 border-pink-300 rounded-xl focus:border-teal-500 text-lg text-center transition duration-300">
                    <button id="name-record-button" onclick="startNameRecording()"
                        class="p-3 bg-blue-500 text-white rounded-xl shadow-lg hover:bg-blue-600 flex items-center justify-center">
                        <i id="name-record-icon" class="fas fa-microphone text-2xl"></i>
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <p class="text-xl font-bold text-teal-600 text-center">Ø£Ù†Ø§:</p>
                <div class="flex justify-around gap-4">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="gender" value="boy" class="hidden peer">
                        <div
                            class="bg-blue-200 p-4 rounded-xl text-center shadow-lg peer-checked:bg-blue-500 peer-checked:text-white border-4 border-blue-500 peer-checked:border-blue-700 transition duration-300 transform hover:scale-105">
                            <span class="text-5xl">ğŸ§‘ğŸ»</span>
                            <span class="block text-lg font-semibold mt-1">ÙˆÙ„Ø¯</span>
                        </div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="gender" value="girl" class="hidden peer">
                        <div
                            class="bg-pink-200 p-4 rounded-xl text-center shadow-lg peer-checked:bg-pink-500 peer-checked:text-white border-4 border-pink-500 peer-checked:border-pink-700 transition duration-300 transform hover:scale-105">
                            <span class="text-5xl">ğŸ‘¸ğŸ»</span>
                            <span class="block text-lg font-semibold mt-1">Ø¨Ù†Øª</span>
                        </div>
                    </label>
                </div>
            </div>

            <button id="start-button" onclick="initializeAudioAndStart()"
                class="w-full bg-pink-500 text-white p-4 rounded-full text-2xl font-bold shadow-xl hover:bg-pink-600 transform hover:scale-105 transition duration-300">
                Ø§Ù†Ø·Ù„Ù‚!
            </button>
            <p id="audio-note" class="text-sm text-center text-red-500 mt-2 font-semibold" style="display:none;">(Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰)</p>
        </div>

        <!-- Rest of your screens remain the same -->
        <div id="avatar-screen" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-8">
            <h2 class="text-3xl font-extrabold text-teal-600 text-center mt-4">Ø§Ø®ØªØ± Ø¨Ø·Ù„Ùƒ Ø§Ù„Ø®Ø§Ø±Ù‚!</h2>

            <div id="avatar-grid" class="grid grid-cols-3 gap-4"></div>

            <button onclick="confirmAvatar()"
                class="w-full bg-teal-500 text-white p-4 rounded-full text-2xl font-bold shadow-xl hover:bg-teal-600 transform hover:scale-105 transition duration-300 mt-6">
                Ù‡Ø°Ù‡ Ø´Ø®ØµÙŠØªÙŠ!
            </button>
        </div>

        <div id="checkin-screen" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-8">
            <div class="text-center bg-yellow-100 p-4 rounded-2xl border-4 border-yellow-300">
                <h2 id="checkin-prompt" class="text-3xl font-extrabold text-gray-800">ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø§Ù„ÙŠÙˆÙ… ÙŠØ§ Ø¨Ø·Ù„ØŸ</h2>
            </div>

            <div class="grid grid-cols-3 gap-4">
                <button onclick="selectEmotion('happy', 'Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©', this)"
                    class="emotion-button bg-green-200 p-4 rounded-2xl hover:bg-green-300 transform hover:scale-105">
                    <span class="text-6xl block animate-bounce">ğŸ˜Š</span>
                    <span class="text-lg font-bold mt-1 text-green-800">Ø³Ø¹ÙŠØ¯</span>
                </button>
                <button onclick="selectEmotion('sad', 'Ø§Ù„Ø­Ø²Ù†', this)"
                    class="emotion-button bg-blue-200 p-4 rounded-2xl hover:bg-blue-300 transform hover:scale-105">
                    <span class="text-6xl block">ğŸ˜Ÿ</span>
                    <span class="text-lg font-bold mt-1 text-blue-800">Ø­Ø²ÙŠÙ†</span>
                </button>
                <button onclick="selectEmotion('angry', 'Ø§Ù„ØºØ¶Ø¨', this)"
                    class="emotion-button bg-red-200 p-4 rounded-2xl hover:bg-red-300 transform hover:scale-105">
                    <span class="text-6xl block animate-shake">ğŸ˜¡</span>
                    <span class="text-lg font-bold mt-1 text-red-800">ØºØ§Ø¶Ø¨</span>
                </button>
                <button onclick="selectEmotion('scared', 'Ø§Ù„Ø®ÙˆÙ', this)"
                    class="emotion-button bg-purple-200 p-4 rounded-2xl hover:bg-purple-300 transform hover:scale-105">
                    <span class="text-6xl block">ğŸ˜¨</span>
                    <span class="text-lg font-bold mt-1 text-purple-800">Ø®Ø§Ø¦Ù</span>
                </button>
                <button onclick="selectEmotion('surprised', 'Ø§Ù„Ø¯Ù‡Ø´Ø©', this)"
                    class="emotion-button bg-yellow-200 p-4 rounded-2xl hover:bg-yellow-300 transform hover:scale-105">
                    <span class="text-6xl block">ğŸ˜²</span>
                    <span class="text-lg font-bold mt-1 text-yellow-800">Ù…ØªÙØ§Ø¬Ø¦</span>
                </button>
                <button onclick="selectEmotion('tired', 'Ø§Ù„ØªØ¹Ø¨', this)"
                    class="emotion-button bg-gray-200 p-4 rounded-2xl hover:bg-gray-300 transform hover:scale-105">
                    <span class="text-6xl block">ğŸ˜´</span>
                    <span class="text-lg font-bold mt-1 text-gray-800">Ù…ØªØ¹Ø¨</span>
                </button>
            </div>

            <button onclick="recordAndNavigate()"
                class="w-full bg-pink-500 text-white p-4 rounded-full text-2xl font-bold shadow-xl hover:bg-pink-600 transform hover:scale-105 transition duration-300 mt-6">
                Ø§ÙƒÙ…Ù„ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©!
            </button>
        </div>

        <!-- Rest of your screens remain the same -->
        <div id="main-menu" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-6">
            <h2 id="menu-welcome" class="text-3xl font-extrabold text-teal-600 text-center mt-4">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„!</h2>

            <div
                class="flex justify-between items-center bg-purple-100 p-3 rounded-xl shadow-inner border-2 border-purple-300">
                <div class="flex items-center space-x-2 space-x-reverse">
                    <span class="text-3xl text-red-500">ğŸ†</span>
                    <span class="text-lg font-bold text-gray-700">Ø§Ù„Ù†Ù‚Ø§Ø·: 45 Ù†Ø¬Ù…Ø©</span>
                </div>
                <button onclick="showScreen('leaderboard-screen')"
                    class="flex items-center space-x-1 space-x-reverse text-purple-600 font-bold p-2 bg-purple-200 rounded-lg hover:bg-purple-300 transform hover:scale-105">
                    <i class="fas fa-chart-bar"></i>
                    <span>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</span>
                </button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="startLevel(1, 'Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©')"
                    class="bg-green-500 text-white p-6 rounded-2xl shadow-xl transform hover:scale-105 transition duration-300 space-y-2 border-4 border-green-700">
                    <span class="text-5xl block">ğŸ˜ŠğŸ˜ ğŸ˜¨</span>
                    <span class="text-xl font-bold">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„</span>
                </button>

                <button onclick="startLevel(2, 'Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ø®ØªÙ„Ø·Ø©')"
                    class="bg-blue-500 text-white p-6 rounded-2xl shadow-xl transform hover:scale-105 transition duration-300 space-y-2 border-4 border-blue-700">
                    <span class="text-5xl block">ğŸ¤¯ğŸ˜µâ€ğŸ’«</span>
                    <span class="text-xl font-bold">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ</span>
                </button>

                <div
                    class="bg-gray-300 text-gray-600 p-6 rounded-2xl shadow-inner space-y-2 opacity-80 border-4 border-gray-400">
                    <span class="text-5xl block">ğŸ”’</span>
                    <span class="text-xl font-bold">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«</span>
                </div>

                <button onclick="showScreen('checkin-screen')"
                    class="bg-yellow-500 text-gray-800 p-6 rounded-2xl shadow-xl hover:bg-yellow-600 transform hover:scale-105 transition duration-300 border-4 border-yellow-700">
                    <span class="text-5xl block">ğŸ—“ï¸</span>
                    <span class="text-xl font-bold">ÙØ­Øµ Ø§Ù„ÙŠÙˆÙ…</span>
                </button>
            </div>
        </div>

        <div id="learning-screen" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-6">
            <h2
                class="text-3xl font-extrabold text-green-600 text-center mt-4 bg-green-100 p-3 rounded-xl border-4 border-green-300">
                Ø´Ø¹ÙˆØ±: Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© (Happiness)</h2>

            <div
                class="aspect-video bg-green-200 rounded-3xl flex items-center justify-center shadow-lg border-4 border-green-500">
                <p class="text-2xl text-green-800 font-bold p-4">Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ ÙÙŠØ¯ÙŠÙˆ ÙƒØ±ØªÙˆÙ†ÙŠ Ø¹Ù† Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</p>
            </div>

            <div class="flex items-center justify-center">
                <button onclick="speakInstruction('Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ØªØ¬Ø¹Ù„Ùƒ ØªØ­Ø¨ Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ù„Ø¶Ø­Ùƒ! Ø§Ø´Ø¹Ø± Ø¨Ù‡Ø§ ÙÙŠ Ù‚Ù„Ø¨Ùƒ!')"
                    class="w-40 h-40 bg-white rounded-full shadow-2xl flex items-center justify-center border-8 border-yellow-500 transform hover:scale-110 transition duration-300">
                    <span class="text-[5rem] animate-pulse">ğŸ˜</span>
                </button>
            </div>
            <p class="text-center text-lg text-gray-700">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ Ù„ØªØ³Ù…Ø¹ Ø¹Ù†Ù‡!</p>

            <div class="flex justify-between gap-4">
                <button onclick="showScreen('main-menu')"
                    class="flex-1 bg-gray-400 text-white p-4 rounded-full text-lg font-bold shadow-xl hover:bg-gray-500 transform hover:scale-105 transition duration-300">
                    <i class="fas fa-home"></i>
                    <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
                </button>
                <button onclick="showScreen('face-detection-screen')"
                    class="flex-1 bg-pink-500 text-white p-4 rounded-full text-lg font-bold shadow-xl hover:bg-pink-600 transform hover:scale-105 transition duration-300">
                    <span>Ø§Ù„ØªØ§Ù„ÙŠ: ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</span>
                    <i class="fas fa-arrow-left mr-2"></i>
                </button>
            </div>
        </div>

        <div id="face-detection-screen" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-6">
            <h2
                class="text-3xl font-extrabold text-blue-600 text-center mt-4 bg-blue-100 p-3 rounded-xl border-4 border-blue-300">
                ØªØ­Ø¯ÙŠ ØªØ¹Ø§Ø¨ÙŠØ± Ø§Ù„ÙˆØ¬Ù‡</h2>

            <p
                class="text-xl text-center text-gray-700 font-semibold p-2 bg-blue-50 rounded-lg border-2 border-blue-200">
                ÙˆØ¬Ù‡Ùƒ Ø¨Ø·Ù„! Ø§Ù„Ø¢Ù† Ø­Ø§ÙˆÙ„ Ø£Ù† ØªØ¹Ø¨Ø± Ø¹Ù† Ø´Ø¹ÙˆØ±: <span class="text-pink-600 font-extrabold text-2xl">ğŸ˜Š Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ğŸ˜Š</span>
            </p>

            <div
                class="w-full aspect-square bg-gray-200 rounded-3xl border-4 border-dashed border-blue-400 flex flex-col items-center justify-center shadow-inner">
                <i class="fas fa-camera text-blue-500 text-6xl"></i>
                <p class="mt-2 text-blue-500 font-semibold">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙ†ØªØ¸Ø± ÙˆØ¬Ù‡Ùƒ Ø§Ù„Ù…Ø¨ØªØ³Ù…</p>
            </div>

            <div id="feedback-area" class="bg-green-100 p-4 rounded-xl text-center border-4 border-green-400">
                <p class="text-xl font-bold text-green-800">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØ´Ù... Ø§Ø¨ØªØ³Ù… ÙŠØ§ Ø¨Ø·Ù„!</p>
            </div>

            <button onclick="showScreen('challenge-screen')"
                class="w-full bg-teal-500 text-white p-4 rounded-full text-2xl font-bold shadow-xl hover:bg-teal-600 transform hover:scale-105 transition duration-300">
                Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            </button>
        </div>

        <div id="challenge-screen" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-6">
            <h2
                class="text-3xl font-extrabold text-pink-600 text-center mt-4 bg-pink-100 p-3 rounded-xl border-4 border-pink-300">
                ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…!</h2>

            <div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-300 space-y-3">
                <p class="text-lg font-bold text-purple-800 text-center">Ø§Ù„Ø³Ø¤Ø§Ù„ (1/5):</p>
                <p class="text-xl text-gray-800 font-semibold text-center">ØªØ®ÙŠÙ„ Ø£Ù† ØµØ¯ÙŠÙ‚Ùƒ ÙƒØ³Ø± Ù„Ø¹Ø¨ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©. Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„Ø£Ù‚Ø±Ø¨ Ø¥Ù„ÙŠÙƒØŸ</p>
                <div class="grid grid-cols-2 gap-3">
                    <button
                        class="p-3 bg-red-200 rounded-xl text-2xl font-bold hover:bg-red-300 transform hover:scale-105 transition duration-200">ØºØ¶Ø¨ ğŸ˜¡</button>
                    <button
                        class="p-3 bg-blue-200 rounded-xl text-2xl font-bold hover:bg-blue-300 transform hover:scale-105 transition duration-200">Ø­Ø²Ù† ğŸ˜Ÿ</button>
                    <button
                        class="p-3 bg-green-200 rounded-xl text-2xl font-bold hover:bg-green-300 transform hover:scale-105 transition duration-200">Ø³Ø¹Ø§Ø¯Ø© ğŸ˜Š</button>
                    <button
                        class="p-3 bg-yellow-200 rounded-xl text-2xl font-bold hover:bg-yellow-300 transform hover:scale-105 transition duration-200">Ø®ÙˆÙ ğŸ˜¨</button>
                </div>
            </div>

            <hr class="border-t-2 border-dashed border-gray-300">

            <div class="space-y-3">
                <h3 class="text-2xl font-bold text-teal-600 text-center">Ø£Ø®Ø¨Ø±Ù†Ø§ Ø¹Ù† ÙŠÙˆÙ…Ùƒ!</h3>
                <div class="flex items-center space-x-2 space-x-reverse">
                    <textarea id="reflection-input" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø¹Ø±Øª Ø¨Ø§Ù„Ø¨Ù‡Ø¬Ø© Ø¹Ù†Ø¯Ù…Ø§..."
                        class="flex-grow p-3 border-4 border-teal-300 rounded-xl h-24 focus:border-teal-500 text-base"></textarea>
                    <button onclick="startVoiceInput('reflection-input')"
                        class="self-start mt-1 p-3 bg-blue-500 text-white rounded-xl shadow-lg hover:bg-blue-600 flex items-center justify-center">
                        <i id="mic-icon-reflection-input" class="fas fa-microphone text-2xl"></i>
                    </button>
                </div>
            </div>

            <button onclick="showScreen('main-menu')"
                class="w-full bg-pink-500 text-white p-4 rounded-full text-2xl font-bold shadow-xl hover:bg-pink-600 transform hover:scale-105 transition duration-300 mt-4">
                Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ!
            </button>
        </div>

        <div id="leaderboard-screen" class="screen-container hidden bg-white p-6 rounded-3xl shadow-2xl space-y-6">
            <h2
                class="text-3xl font-extrabold text-yellow-600 text-center mt-4 bg-yellow-100 p-3 rounded-xl border-4 border-yellow-300">
                Ù„ÙˆØ­Ø© Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</h2>

            <div class="bg-white p-4 rounded-xl border-4 border-teal-400 shadow-xl space-y-2">
                <h3 class="text-2xl font-bold text-teal-600 text-center">Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                <div class="flex justify-around text-center">
                    <div>
                        <span class="text-5xl font-extrabold text-pink-500 block">3</span>
                        <span class="text-sm text-gray-600">Ù…Ø³ØªÙˆÙŠØ§Øª</span>
                    </div>
                    <div>
                        <span class="text-5xl font-extrabold text-pink-500 block">45</span>
                        <span class="text-sm text-gray-600">Ù†Ø¬Ù…Ø©</span>
                    </div>
                    <div>
                        <span class="text-5xl font-extrabold text-pink-500 block">ğŸ”¥3</span>
                        <span class="text-sm text-gray-600">Ø£ÙŠØ§Ù… Ø³Ù„Ø³Ù„Ø©</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl border-2 border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800 mb-3 text-center">ğŸ† Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
                <ul class="space-y-3">
                    <li
                        class="flex justify-between items-center p-3 bg-yellow-100 rounded-lg shadow-md border-r-8 border-yellow-500 transform hover:scale-[1.02] transition duration-200">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <span class="text-2xl font-extrabold text-yellow-700">1</span>
                            <span class="text-3xl">ğŸ¥‡</span>
                            <span class="text-lg font-bold text-gray-800">Ø§Ù„Ø¨Ø·Ù„ Ø£Ø­Ù…Ø¯</span>
                        </div>
                        <span class="text-xl font-bold text-yellow-700">52 Ù†Ø¬Ù…Ø©</span>
                    </li>
                    <li
                        class="flex justify-between items-center p-3 bg-gray-100 rounded-lg border-r-4 border-gray-400 transform hover:scale-[1.02] transition duration-200">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <span class="text-2xl font-extrabold text-gray-700">2</span>
                            <span class="text-3xl">ğŸ¥ˆ</span>
                            <span class="text-lg font-bold text-gray-800">Ø§Ù„Ø¨Ø·Ù„Ø© Ø³Ø§Ø±Ø©</span>
                        </div>
                        <span class="text-xl font-bold text-gray-700">48 Ù†Ø¬Ù…Ø©</span>
                    </li>
                    <li
                        class="flex justify-between items-center p-3 bg-pink-50 rounded-lg border-r-4 border-pink-500 font-bold transform hover:scale-[1.02] transition duration-200">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <span class="text-2xl font-extrabold text-pink-600">4</span>
                            <span class="text-lg text-pink-600">Ø£Ù†Øª!</span>
                        </div>
                        <span class="text-xl font-bold text-pink-600">45 Ù†Ø¬Ù…Ø©</span>
                    </li>
                </ul>
            </div>

            <button onclick="showScreen('main-menu')"
                class="w-full bg-teal-500 text-white p-4 rounded-full text-2xl font-bold shadow-xl hover:bg-teal-600 transform hover:scale-105 transition duration-300 mt-4">
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
        </div>
    </div>
</body>
</html>
